<!doctype html>
<html lang="en">
  <head>
    <!-- Required meta tags -->
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

    <!-- Bootstrap CSS -->
    <link rel="stylesheet" href="./sjfpage.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/css/bootstrap.min.css" integrity="sha384-ggOyR0iXCbMQv3Xipma34MD+dH/1fQ784/j6cY/iJTQUOhcWr7x9JvoRxT2MZw1T" crossorigin="anonymous">
    <link rel="stylesheet" href="https://www.amcharts.com/lib/3/plugins/export/export.css" type="text/css" media="all" />
    <title>Shortest Job First</title>
  </head>
  <body style="background-color: #4a4a58;">
    <div id="carouselExampleIndicators" class="carousel slide" data-ride="carousel">
        <ol class="carousel-indicators">
          <li data-target="#carouselExampleIndicators" data-slide-to="0" class="active"></li>
          <li data-target="#carouselExampleIndicators" data-slide-to="1"></li>
        </ol>
        <div class="carousel-inner">
          <div class="carousel-item active">
            <img class="d-block w-100" src="img1.png" alt="First slide">
          </div>
          <div class="carousel-item">
            <img class="d-block w-100" src="img2.png" alt="Second slide">
          </div>
        </div>
        
        <a class="carousel-control-prev" href="#carouselExampleIndicators" role="button" data-slide="prev">
          <span class="carousel-control-prev-icon" aria-hidden="true" ></span>
          <span class="sr-only">Previous</span>
        </a>
        <a class="carousel-control-next" href="#carouselExampleIndicators" role="button" data-slide="next">
          <span class="carousel-control-next-icon" aria-hidden="true"></span>
          <span class="sr-only">Next</span>
        </a>
      </div>
      <div style="margin: 20px;"></div>
        <div class="container-1">
          <form class="input-form">
            <div class="form-group">
                <label style="color: aliceblue;">Process ID: </label>
                <input type="number" id="PID" name="PID" value="" >
            </div>
            <div class="form-group">
                <label  style="color: aliceblue;">Burst Time: </label>
                <input type="number" id="burstTime" value="">
            </div>
            <div class="form-group">
                <label  style="color: aliceblue;">Arrival Time: </label>
                <input type="number" id="arrivalTime" value="">
            </div>
            <div class="form-group">
                <button class="button" type="button" onclick="createTable(), clearCell()">Enter values to the table</button>
            </div>
            <!-- <div class="form-group">
              <button class="button" type="button" onclick="printValues()">Calculate the results</button>
            </div> -->
            <div class="form-group">
              <button class="button" type="button" onclick="printGanttChart()">Display Gantt Chart and Details</button>
            </div>
          </form>
        </div>
        
        <div class="container">
          <table id="inputTable">
              <tr>
                  <th>PID</th>
                  <th>Burst Time</th>
                  <th>Arrival Time</th>
              </tr>
          </table>
      </div>

<h1 class="heading">Non-Preemptive Solution</h1>
<div>
  <table id="statTable">
      <tr>
          <th>PID</th>
          <th>Completion Time</th>
          <th>Turnaround Time</th>
          <th>Waiting Time</th>
      </tr>
  </table>
</div>


<div id="statTable-s">
  <div class="block">
      <label>Average waiting time: </label>
      <label id="wtOutput"></label>
  </div>

  <div class="block">
      <label>Average turnaround time: </label>
      <label id="taOutput"></label>
   </div>
</div>

<script>

</script>

<section class="container">
  <div id="chartdiv"></div>
  <script type="text/javascript">
    function createTable()
    {
      var processID=document.getElementById("PID").value;
      var burstTime=document.getElementById("burstTime").value;
      var arrivalTime=document.getElementById("arrivalTime").value;

      if( (processID=='') &&(burstTime=='') &&(arrivalTime=='')) {
        alert("Please insert some data first!!");
      }
      else if( (processID<=0) || (burstTime<=0) || (arrivalTime<=0) ) {
        alert("Negative or zero values are not accepted");
      }
      else {
            var table=document.getElementById("inputTable");
            var firstRow = table.insertRow(-1);
            var cell1 = firstRow.insertCell(0);
            var cell2 = firstRow.insertCell(1);
            var cell3 = firstRow.insertCell(2);
    
            cell1.innerHTML=processID;
            cell2.innerHTML=burstTime;
            cell3.innerHTML=arrivalTime;
      }
      var x = document.getElementById("inputTable").rows.length;
    }

function clearCell() {
    document.getElementById("PID").value = '';
    document.getElementById("burstTime").value = '';
    document.getElementById("arrivalTime").value = '';
}

        function GetCellValues()
        {
            var pid =[];
            var at =[];
            var bt =[];
            var flag =[];
            var bt2=[];

            // items is the sorted list
            var items = [];

            var table = document.getElementById('inputTable');
            for (var r = 1, n = table.rows.length; r < n; r++) {
                for (var c = 0, m = table.rows[r].cells.length; c < m; c++) {
                     //console.log(table.rows[r].cells[c].innerHTML);
                }
                pid.push(parseInt(table.rows[r].cells[0].innerHTML));
                bt.push(parseInt(table.rows[r].cells[1].innerHTML));
                bt2.push(parseInt(table.rows[r].cells[1].innerHTML));
                at.push(parseInt(table.rows[r].cells[2].innerHTML));
                flag.push(0);
            }
            items = nonPreemptiveSelection(pid,at,bt,flag);
            return items;
          }

          function nonPreemptiveSelection(pid,at,bt,flag)
          {
            var n = pid.length;
            var clock = 0;
            var tot = 0;
            var items =[];
            var ct=[];
            var ta=[];
            var wt=[];
            var avgwt=0;
            var avgta=0;

            while(true)
            {
                var min=100;
                var c = n; // c represents the current PID
                if (tot == n) // total no of process = completed process loop will be terminated
                    break;
                
                for (var i=0; i< n; i++)
                {
                    /*
                     * If i'th process arrival time <= system time and its flag=0 and burst<min 
                     * That process will be executed first 
                     */
                    var count=0;
                    if ((at[i] <= clock) && (flag[i] == 0) && (bt[i]<min))
                        {
                            min=bt[i];
                            c=i;
                        }
                }
                /* If c==n means c value can not updated because no process arrival time< system time so we increase the system time */
                if (c==n) 
                    clock++;
                else
                {
                    var temp = [];
                    temp.push(pid[c]);
                    temp.push(bt[c]);
                    items.push(temp);

                    ct[c]=clock+bt[c];
                    ta[c]=ct[c]-at[c];
                    wt[c]=ta[c]-bt[c];
                    
                    clock+=bt[c];
                    flag[c]=1;
                    tot++;   
                }
            }

            for(i=0;i<n;i++)
            {
                avgwt +=wt[i];
                avgta +=ta[i];
            }

            avgwt/=n;
            avgta/=n;
            printStat(ct,ta,wt,avgwt,avgta,pid); 
            return items;
          }

        function generateGanttChartData(data)
        {   
            // Data contains the processes in the required order
            var n = data.length;
            var finalData = [];
            var clock = 0;
            
            //console.log(n);

            for (var i=0; i<n; i++)
            {
                var temp = {
                        "category": "",
                        "segments": [ {
                            "start": 0,
                            "duration": 0,
                            "color": "#727d6f",
                            "task": ""
                        }, ]
                    }

                temp.category = "Process " + (parseInt(data[i][0])).toString();
                temp.segments[0].start = clock;
                temp.segments[0].duration = data[i][1];
                temp.segments[0].task = "Process " + (parseInt(data[i][0])).toString();

                clock = clock + data[i][1];
                finalData.push(temp);
            }
            return finalData;
        }

        function printStat(ct,ta,wt,avgwt,avgta,pid)
        {
            console.log(ct);
            console.log(ta);
            console.log(wt);
            console.log(avgwt);
            console.log(avgta);
            
            document.getElementById("wtOutput").innerHTML=((avgwt).toFixed(5));
            document.getElementById("taOutput").innerHTML=((avgta).toFixed(5));
            
            var table_2=document.getElementById("statTable");
        
            console.log("len");
            console.log(table_2.rows.length);

            for(var i = table_2. rows. length; i > 1; i--)
            {
                    console.log(i);
                    table_2. deleteRow(i-1);
            }

            for (var i=0;i<pid.length;i++)
            {   
            var firstRow = table_2.insertRow(i+1);
            var cell1 = firstRow.insertCell(0);
            var cell2 = firstRow.insertCell(1);
            var cell3 = firstRow.insertCell(2);
            var cell4 = firstRow.insertCell(3);
                cell1.innerHTML=pid[i];
                cell2.innerHTML=ct[i];
                cell3.innerHTML=ta[i];
                cell4.innerHTML=wt[i];
            }
        }

        function printGanttChart()
        {
            //chartData contains data for dataProvider KEY
            var chartData = generateGanttChartData(GetCellValues());

            var chart = AmCharts.makeChart( "chartdiv", 
                {
                "type": "gantt",
                "theme": "dark",
                "marginRight": 70,
                "period": "hh:mm:ss",
                "dataDateFormat":"YYYY-MM-DD",
                "balloonDateFormat": "JJ:NN",
                "columnWidth": 0.5,
                "valueAxis": {
                    "type": "timecode"
                },
                "brightnessStep": 10,
                "graph": {
                    "fillAlphas": 1,
                    "balloonText": "<b>[[task]]</b>: [[open]] [[value]]"
                },
                "rotate": true,
                "categoryField": "category",
                "segmentsField": "segments",
                "colorField": "color",
                "startDate": "00:00:00:00",
                "startField": "start",
                "endField": "end",
                "durationField": "duration",


                // This key contains values generated by generateGanttChartData FUNCTION
                "dataProvider": chartData,


                "valueScrollbar": {
                    "autoGridCount":true
                },
                "chartCursor": {
                    "cursorColor":"#55bb76",
                    "valueBalloonsEnabled": false,
                    "cursorAlpha": 0,
                    "valueLineAlpha":0.5,
                    "valueLineBalloonEnabled": true,
                    "valueLineEnabled": true,
                    "zoomable":false,
                    "valueZoomable":true
                },
                "export": {
                    "enabled": true
                 }
            } );
        }
  </script>
</section>





<!-- Optional JavaScript -->
    <!-- jQuery first, then Popper.js, then Bootstrap JS -->
    <script src="https://code.jquery.com/jquery-3.3.1.slim.min.js" integrity="sha384-q8i/X+965DzO0rT7abK41JStQIAqVgRVzpbzo5smXKp4YfRvH+8abtTE1Pi6jizo" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/popper.js@1.14.7/dist/umd/popper.min.js" integrity="sha384-UO2eT0CpHqdSJQ6hJty5KVphtPhzWj9WO1clHTMGa3JDZwrnQq4sF86dIHNDz0W1" crossorigin="anonymous"></script>
    <script src="https://cdn.jsdelivr.net/npm/bootstrap@4.3.1/dist/js/bootstrap.min.js" integrity="sha384-JjSmVgyd0p3pXB1rRibZUAYoIIy6OrQ6VrjIEaFf/nJGzIxFDsf4x0xIM+B07jRM" crossorigin="anonymous"></script>
    <script src="https://www.amcharts.com/lib/3/amcharts.js"></script>
    <script src="https://www.amcharts.com/lib/3/serial.js"></script>
    <script src="https://www.amcharts.com/lib/3/gantt.js"></script>
    <script src="https://www.amcharts.com/lib/3/themes/dark.js"></script>
    <script src="https://www.amcharts.com/lib/3/plugins/export/export.min.js"></script>
    <script src="./sjfjavascript.js"></script>

</body>
</html>